import{e as se,ab as ne,ac as yt,J as mt,ad as Kt,ae as F}from"./IKRootsHelper-DmBdh0X7.js";import{U as xt,u as Mt,s as bt}from"./URDFLoader-Dz40SxeK.js";function ie(t){const e=new Map,r=[];for(let s=0,n=t.length;s<n;s++){const o=t[s],{name:i,dof:a,dofValues:c,dofTarget:h,dofRestPose:l,minDoFLimit:p,maxDoFLimit:u,targetSet:v,restPoseSet:O,position:_,quaternion:J,isClosure:ht}=o;let S="Link";o.isGoal?S="Goal":o.isJoint&&(S="Joint");const G={dof:a?a.slice():null,dofValues:c?c.slice():null,dofTarget:h?h.slice():null,dofRestPose:l?l.slice():null,minDoFLimit:p?p.slice():null,maxDoFLimit:u?u.slice():null,targetSet:v,restPoseSet:O,isClosure:ht,name:i,position:_.slice(),quaternion:J.slice(),children:null,closureJoints:null,child:null,type:S};r.push(G),e.set(o,s)}for(let s=0,n=t.length;s<n;s++){const o=r[s],i=t[s];o.children=i.children.map(a=>e.get(a)),i.isLink&&(o.closureJoints=i.closureJoints.map(a=>e.get(a))),i.isJoint&&i.child&&(o.child=e.get(i.child)),i.parent?o.parent=e.get(i.parent):o.parent=null}return r}const gt=304;function oe(t,e=!0){let r;e?r=new SharedArrayBuffer(gt*t.length):r=new ArrayBuffer(gt*t.length);const s=new Float32Array(r),n=new Uint8Array(r);return zt(t,s,n),r}function zt(t,e,r,s=!0,n=!0){for(let o=0,i=t.length;o<i;o++)Qt(t[o],e,r,o*gt,s,n)}function Qt(t,e,r,s,n=!0,o=!0){const i=s/4;if(o){const{position:a,quaternion:c}=t;for(let h=0;h<3;h++)e[i+0+h]=a[h];for(let h=0;h<4;h++)e[i+3+h]=c[h];if(t.isJoint){const{dofTarget:h,dofRestPose:l,minDoFLimit:p,maxDoFLimit:u,targetSet:v,restPoseSet:O}=t;for(let _=0;_<6;_++)e[i+7+0*6+_]=h[_],e[i+7+1*6+_]=l[_],e[i+7+2*6+_]=p[_],e[i+7+3*6+_]=u[_];r[s+148]=Number(v),r[s+149]=Number(O)}}if(n&&t.isJoint){const{dofValues:a}=t;for(let c=0;c<6;c++)e[i+7+4*6+c]=a[c]}}function ae(t,e,r,s,n=!0,o=!0){const i=s/4;if(o&&(t.setPosition(e[i+0],e[i+1],e[i+2]),t.setQuaternion(e[i+3+0],e[i+3+1],e[i+3+2],e[i+3+3]),t.isJoint)){const{dofTarget:a,dofRestPose:c,minDoFLimit:h,maxDoFLimit:l}=t;for(let p=0;p<6;p++)a[p]=e[i+7+0*6+p],c[p]=e[i+7+1*6+p],h[p]=e[i+7+2*6+p],l[p]=e[i+7+3*6+p];t.targetSet=!!r[s+148],t.restPoseSet=!!r[s+149]}if(n&&t.isJoint){const{dofValues:a}=t;let c=!1;for(let h=0;h<6;h++){const l=e[i+7+24+h];l!==a[h]&&(a[h]=l,c=!0)}c&&t.setMatrixDoFNeedsUpdate()}}const pt=typeof SharedArrayBuffer<"u";class cr{constructor(e=[]){this.roots=Array.isArray(e)?[...e]:[e],this.status=[],this.running=!1,this.frames=null,this.buffer=null,this.floatBuffer=null,this.byteBuffer=null,this.jointsToUpdate=null,this.jointsToIndexMap=null,this.scheduledStateUpdate=!1;const r=new Worker(new URL(""+new URL("workerSolver.worker-BAF4_xNX.js",import.meta.url).href,import.meta.url),{type:"module"});let s=!1;r.onmessage=({data:n})=>{if(n.type==="updateSolve"){s||(s=!0,Promise.resolve().then(()=>{let i,a;pt?(i=this.byteBuffer,a=this.floatBuffer):(i=new Uint8Array(n.data.buffer),a=new Float32Array(n.data.buffer));const{jointsToIndexMap:c,jointsToUpdate:h}=this;for(let l=0,p=h.length;l<p;l++){const u=h[l],v=c.get(u);ae(u,a,i,v*gt,!0,!1)}s=!1}));const o=n.data.status;this.status=o,o!==se.TIMEOUT&&(this.running=!1)}},this.worker=r,this.updateStructure()}updateStructure(){const{worker:e}=this,r=ne(this.roots),s=new Set;r.forEach(p=>p.traverse(u=>{s.add(u)}));const n=Array.from(s),o=ie(n),i=oe(n,pt),a=new Float32Array(i),c=new Uint8Array(i),h=[],l=new Map;for(let p=0,u=n.length;p<u;p++){const v=n[p];v.isJoint&&v.dof.length>0&&(h.push(v),l.set(v,p))}pt?(this.buffer=i,this.floatBuffer=a,this.byteBuffer=c):(this.buffer=i.slice(),this.floatBuffer=new Float32Array(this.buffer),this.byteBuffer=new Uint8Array(this.buffer)),this.frames=n,this.jointsToUpdate=h,this.jointsToIndexMap=l,pt?e.postMessage({type:"updateStructure",data:{serialized:o,buffer:i}}):e.postMessage({type:"updateStructure",data:{serialized:o,buffer:i}},[i])}updateSolverSettings(e){this.worker.postMessage({type:"updateSolverSettings",data:e})}updateFrameState(...e){const{frames:r,floatBuffer:s,byteBuffer:n}=this;if(e.length===0)zt(r,s,n,!1,!0);else for(let o=0,i=e.length;o<i;o++){const a=e[o],c=r.indexOf(a);Qt(a,s,n,gt*c,!1,!0)}!pt&&!this.scheduledStateUpdate&&(this.scheduledStateUpdate=!0,Promise.resolve().then(()=>{this.scheduledStateUpdate=!1;const o=this.buffer.slice();this.worker.postMessage({type:"updateFrameState",data:{buffer:o}},[o])}))}solve(){this.worker.postMessage({type:"startSolve"}),this.running=!0}stop(){this.worker.postMessage({type:"stopSolve"}),this.running=!1}dispose(){this.stop(),this.worker.terminate(),this.worker=null}}function Nt(t){const e=t.split(/[\\/]/g);return e.pop(),e.length===0?"./":e.join("/")+"/"}function K(t,e,r=[]){t.tagName===e&&r.push(t);for(let s=0,n=t.children.length;s<n;s++){const o=t.children[s];K(o,e,r)}return r}function ft(t,e){const r=t.cloneNode(),s=t.childNodes;for(let n=0,o=s.length;n<o;n++){const i=s[n],a=i.tagName;(!e||a!=="xacro:property"&&a!=="xacro:macro")&&r.appendChild(ft(i,e))}return r}function tt(t){for(;t.length>0;){const e=t[t.length-1];if(e.nodeType!==e.ELEMENT_NODE)t.pop();else break}}function ue(t){return/^[()/*+\-%|&=[\]]+$/.test(t)}function Jt(t){return/^(('[^']*?')|("[^"]*?")|(`[^`]*?`))$/.test(t)}function dt(t){return!isNaN(parseFloat(t))&&!/[^0-9.eE-]/.test(t)}function he(t){const e=/(('[^']*?')|("[^"]*?")|(`[^`]*?`)|([()/*+\-%|&=[\]]+))/g;return t.replace(e,r=>` ${r} `).trim().split(/\s+/g)}function le(t){return t.replace(/[-+]{2,}/,e=>{let r=!0;for(let s=0,n=e.length;s<n;s++)e[s]==="-"&&(r=!r);return r?"+":"-"})}const rt=Symbol("parent");function St(...t){const e={};for(let r=0,s=t.length;r<s;r++){const n=t[r];for(const o in n)e[o]=n[o];rt in n&&(e[rt]=n[rt])}return e}function ce(t){const e=St(t);return e[rt]=t,e}var R="INUMBER",ot="IOP1",at="IOP2",ut="IOP3",q="IVAR",Q="IVARNAME",st="IFUNCALL",Et="IFUNDEF",C="IEXPR",It="IEXPREVAL",H="IMEMBER",At="IENDSTATEMENT",nt="IARRAY";function m(t,e){this.type=t,this.value=e??0}m.prototype.toString=function(){switch(this.type){case R:case ot:case at:case ut:case q:case Q:case At:return this.value;case st:return"CALL "+this.value;case Et:return"DEF "+this.value;case nt:return"ARRAY "+this.value;case H:return"."+this.value;default:return"Invalid Instruction"}};function kt(t){return new m(ot,t)}function X(t){return new m(at,t)}function Ht(t){return new m(ut,t)}function Ct(t,e,r,s,n){for(var o=[],i=[],a,c,h,l,p=0;p<t.length;p++){var u=t[p],v=u.type;if(v===R||v===Q)Array.isArray(u.value)?o.push.apply(o,Ct(u.value.map(function(O){return new m(R,O)}).concat(new m(nt,u.value.length)),e,r,s,n)):o.push(u);else if(v===q&&n.hasOwnProperty(u.value))u=new m(R,n[u.value]),o.push(u);else if(v===at&&o.length>1)c=o.pop(),a=o.pop(),l=r[u.value],u=new m(R,l(a.value,c.value)),o.push(u);else if(v===ut&&o.length>2)h=o.pop(),c=o.pop(),a=o.pop(),u.value==="?"?o.push(a.value?c.value:h.value):(l=s[u.value],u=new m(R,l(a.value,c.value,h.value)),o.push(u));else if(v===ot&&o.length>0)a=o.pop(),l=e[u.value],u=new m(R,l(a.value)),o.push(u);else if(v===C){for(;o.length>0;)i.push(o.shift());i.push(new m(C,Ct(u.value,e,r,s,n)))}else if(v===H&&o.length>0)a=o.pop(),o.push(new m(R,a.value[u.value]));else{for(;o.length>0;)i.push(o.shift());i.push(u)}}for(;o.length>0;)i.push(o.shift());return i}function Yt(t,e,r){for(var s=[],n=0;n<t.length;n++){var o=t[n],i=o.type;if(i===q&&o.value===e)for(var a=0;a<r.tokens.length;a++){var c=r.tokens[a],h;c.type===ot?h=kt(c.value):c.type===at?h=X(c.value):c.type===ut?h=Ht(c.value):h=new m(c.type,c.value),s.push(h)}else i===C?s.push(new m(C,Yt(o.value,e,r))):s.push(o)}return s}function z(t,e,r){var s=[],n,o,i,a,c,h;if(Ft(t))return D(t,r);for(var l=t.length,p=0;p<l;p++){var u=t[p],v=u.type;if(v===R||v===Q)s.push(u.value);else if(v===at)o=s.pop(),n=s.pop(),u.value==="and"?s.push(n?!!z(o,e,r):!1):u.value==="or"?s.push(n?!0:!!z(o,e,r)):u.value==="="?(a=e.binaryOps[u.value],s.push(a(n,z(o,e,r),r))):(a=e.binaryOps[u.value],s.push(a(D(n,r),D(o,r))));else if(v===ut)i=s.pop(),o=s.pop(),n=s.pop(),u.value==="?"?s.push(z(n?o:i,e,r)):(a=e.ternaryOps[u.value],s.push(a(D(n,r),D(o,r),D(i,r))));else if(v===q)if(u.value in e.functions)s.push(e.functions[u.value]);else if(u.value in e.unaryOps&&e.parser.isOperatorEnabled(u.value))s.push(e.unaryOps[u.value]);else{var O=r[u.value];if(O!==void 0)s.push(O);else throw new Error("undefined variable: "+u.value)}else if(v===ot)n=s.pop(),a=e.unaryOps[u.value],s.push(a(D(n,r)));else if(v===st){for(h=u.value,c=[];h-- >0;)c.unshift(D(s.pop(),r));if(a=s.pop(),a.apply&&a.call)s.push(a.apply(void 0,c));else throw new Error(a+" is not a function")}else if(v===Et)s.push(function(){for(var _=s.pop(),J=[],ht=u.value;ht-- >0;)J.unshift(s.pop());var S=s.pop(),G=function(){for(var vt=Object.assign({},r),W=0,Z=J.length;W<Z;W++)vt[J[W]]=arguments[W];return z(_,e,vt)};return Object.defineProperty(G,"name",{value:S,writable:!1}),r[S]=G,G}());else if(v===C)s.push(pe(u,e));else if(v===It)s.push(u);else if(v===H)n=s.pop(),s.push(n[u.value]);else if(v===At)s.pop();else if(v===nt){for(h=u.value,c=[];h-- >0;)c.unshift(s.pop());s.push(c)}else throw new Error("invalid Expression")}if(s.length>1)throw new Error("invalid Expression (parity)");return s[0]===0?0:D(s[0],r)}function pe(t,e,r){return Ft(t)?t:{type:It,value:function(s){return z(t.value,e,s)}}}function Ft(t){return t&&t.type===It}function D(t,e){return Ft(t)?t.value(e):t}function Rt(t,e){for(var r=[],s,n,o,i,a,c,h=0;h<t.length;h++){var l=t[h],p=l.type;if(p===R)typeof l.value=="number"&&l.value<0?r.push("("+l.value+")"):Array.isArray(l.value)?r.push("["+l.value.map($t).join(", ")+"]"):r.push($t(l.value));else if(p===at)n=r.pop(),s=r.pop(),i=l.value,e?i==="^"?r.push("Math.pow("+s+", "+n+")"):i==="and"?r.push("(!!"+s+" && !!"+n+")"):i==="or"?r.push("(!!"+s+" || !!"+n+")"):i==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+s+"),("+n+")))"):i==="=="?r.push("("+s+" === "+n+")"):i==="!="?r.push("("+s+" !== "+n+")"):i==="["?r.push(s+"[("+n+") | 0]"):r.push("("+s+" "+i+" "+n+")"):i==="["?r.push(s+"["+n+"]"):r.push("("+s+" "+i+" "+n+")");else if(p===ut)if(o=r.pop(),n=r.pop(),s=r.pop(),i=l.value,i==="?")r.push("("+s+" ? "+n+" : "+o+")");else throw new Error("invalid Expression");else if(p===q||p===Q)r.push(l.value);else if(p===ot)s=r.pop(),i=l.value,i==="-"||i==="+"?r.push("("+i+s+")"):e?i==="not"?r.push("(!"+s+")"):i==="!"?r.push("fac("+s+")"):r.push(i+"("+s+")"):i==="!"?r.push("("+s+"!)"):r.push("("+i+" "+s+")");else if(p===st){for(c=l.value,a=[];c-- >0;)a.unshift(r.pop());i=r.pop(),r.push(i+"("+a.join(", ")+")")}else if(p===Et){for(n=r.pop(),c=l.value,a=[];c-- >0;)a.unshift(r.pop());s=r.pop(),e?r.push("("+s+" = function("+a.join(", ")+") { return "+n+" })"):r.push("("+s+"("+a.join(", ")+") = "+n+")")}else if(p===H)s=r.pop(),r.push(s+"."+l.value);else if(p===nt){for(c=l.value,a=[];c-- >0;)a.unshift(r.pop());r.push("["+a.join(", ")+"]")}else if(p===C)r.push("("+Rt(l.value,e)+")");else if(p!==At)throw new Error("invalid Expression")}return r.length>1&&(e?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function $t(t){return typeof t=="string"?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function et(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function jt(t,e,r){r=r||{};for(var s=!!r.withMembers,n=null,o=0;o<t.length;o++){var i=t[o];i.type===q||i.type===Q?!s&&!et(e,i.value)?e.push(i.value):(n!==null&&(et(e,n)||e.push(n)),n=i.value):i.type===H&&s&&n!==null?n+="."+i.value:i.type===C?jt(i.value,e,r):n!==null&&(et(e,n)||e.push(n),n=null)}n!==null&&!et(e,n)&&e.push(n)}function L(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}L.prototype.simplify=function(t){return t=t||{},new L(Ct(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)};L.prototype.substitute=function(t,e){return e instanceof L||(e=this.parser.parse(String(e))),new L(Yt(this.tokens,t,e),this.parser)};L.prototype.evaluate=function(t){return t=t||{},z(this.tokens,this,t)};L.prototype.toString=function(){return Rt(this.tokens,!1)};L.prototype.symbols=function(t){t=t||{};var e=[];return jt(this.tokens,e,t),e};L.prototype.variables=function(t){t=t||{};var e=[];jt(this.tokens,e,t);var r=this.functions;return e.filter(function(s){return!(s in r)})};L.prototype.toJSFunction=function(t,e){var r=this,s=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Rt(this.simplify(e).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var wt="TEOF",A="TOP",Pt="TNUMBER",Zt="TSTRING",B="TPAREN",it="TBRACKET",Tt="TCOMMA",Lt="TNAME",Ut="TSEMICOLON";function te(t,e,r){this.type=t,this.value=e,this.index=r}te.prototype.toString=function(){return this.type+": "+this.value};function T(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}T.prototype.newToken=function(t,e,r){return new te(t,e,r??this.pos)};T.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};T.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};T.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(wt,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};T.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if(r==="'"||r==='"')for(var s=this.expression.indexOf(r,e+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,this.expression.charAt(s-1)!=="\\"){var n=this.expression.substring(e+1,s);this.current=this.newToken(Zt,this.unescape(n),e),t=!0;break}s=this.expression.indexOf(r,s+1)}return t};T.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return t==="("||t===")"?(this.current=this.newToken(B,t),this.pos++,!0):!1};T.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return(t==="["||t==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(it,t),this.pos++,!0):!1};T.prototype.isComma=function(){var t=this.expression.charAt(this.pos);return t===","?(this.current=this.newToken(Tt,","),this.pos++,!0):!1};T.prototype.isSemicolon=function(){var t=this.expression.charAt(this.pos);return t===";"?(this.current=this.newToken(Ut,";"),this.pos++,!0):!1};T.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(s in this.consts)return this.current=this.newToken(Pt,this.consts[s]),this.pos+=s.length,!0}return!1};T.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(A,s),this.pos+=s.length,!0}return!1};T.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()){if(e===this.pos&&(s==="$"||s==="_")){s==="_"&&(r=!0);continue}else if(e===this.pos||!r||s!=="_"&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(t,e);return this.current=this.newToken(Lt,n),this.pos+=n.length,!0}return!1};T.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);(e===" "||e==="	"||e===`
`||e==="\r")&&(t=!0,this.pos++,!(this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var fe=/^[0-9a-f]{4}$/i;T.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var s=t.charAt(++e);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var n=t.substring(e+1,e+5);fe.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++e;var o=t.indexOf("\\",e);r+=t.substring(e,o<0?t.length:o),e=o}return r};T.prototype.isComment=function(){var t=this.expression.charAt(this.pos);return t==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};T.prototype.isRadixInteger=function(){var t=this.pos;if(t>=this.expression.length-2||this.expression.charAt(t)!=="0")return!1;++t;var e,r;if(this.expression.charAt(t)==="x")e=16,r=/^[0-9a-f]$/i,++t;else if(this.expression.charAt(t)==="b")e=2,r=/^[01]$/i,++t;else return!1;for(var s=!1,n=t;t<this.expression.length;){var o=this.expression.charAt(t);if(r.test(o))t++,s=!0;else break}return s&&(this.current=this.newToken(Pt,parseInt(this.expression.substring(n,t),e)),this.pos=t),s};T.prototype.isNumber=function(){for(var t=!1,e=this.pos,r=e,s=e,n=!1,o=!1,i;e<this.expression.length&&(i=this.expression.charAt(e),i>="0"&&i<="9"||!n&&i===".");)i==="."?n=!0:o=!0,e++,t=o;if(t&&(s=e),i==="e"||i==="E"){e++;for(var a=!0,c=!1;e<this.expression.length;){if(i=this.expression.charAt(e),a&&(i==="+"||i==="-"))a=!1;else if(i>="0"&&i<="9")c=!0,a=!1;else break;e++}c||(e=s)}return t?(this.current=this.newToken(Pt,parseFloat(this.expression.substring(r,e))),this.pos=e):this.pos=s,t};T.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if(e==="+"||e==="-"||e==="*"||e==="/"||e==="%"||e==="^"||e==="?"||e===":"||e===".")this.current=this.newToken(A,e);else if(e==="∙"||e==="•")this.current=this.newToken(A,"*");else if(e===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(A,">="),this.pos++):this.current=this.newToken(A,">");else if(e==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(A,"<="),this.pos++):this.current=this.newToken(A,"<");else if(e==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(A,"||"),this.pos++;else return!1;else if(e==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(A,"=="),this.pos++):this.current=this.newToken(A,e);else if(e==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(A,"!="),this.pos++):this.current=this.newToken(A,e);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=t,!1)};T.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)};T.prototype.getCoordinates=function(){var t=0,e,r=-1;do t++,e=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:t,column:e}};T.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)};function P(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}P.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};P.prototype.tokenMatches=function(t,e){return typeof e>"u"?!0:Array.isArray(e)?et(e,t.value):typeof e=="function"?e(t):t.value===e};P.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};P.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};P.prototype.accept=function(t,e){return this.nextToken.type===t&&this.tokenMatches(this.nextToken,e)?(this.next(),!0):!1};P.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}};P.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;function r(n){return n.value in e}if(this.accept(Lt)||this.accept(A,r))t.push(new m(q,this.current.value));else if(this.accept(Pt))t.push(new m(R,this.current.value));else if(this.accept(Zt))t.push(new m(R,this.current.value));else if(this.accept(B,"("))this.parseExpression(t),this.expect(B,")");else if(this.accept(it,"["))if(this.accept(it,"]"))t.push(new m(nt,0));else{var s=this.parseArrayList(t);t.push(new m(nt,s))}else throw new Error("unexpected "+this.nextToken)};P.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),!this.parseUntilEndStatement(t,e)&&this.pushExpression(t,e))};P.prototype.pushExpression=function(t,e){for(var r=0,s=e.length;r<s;r++)t.push(e[r])};P.prototype.parseUntilEndStatement=function(t,e){return this.accept(Ut)?(this.nextToken&&this.nextToken.type!==wt&&!(this.nextToken.type===B&&this.nextToken.value===")")&&e.push(new m(At)),this.nextToken.type!==wt&&this.parseExpression(e),t.push(new m(C,e)),!0):!1};P.prototype.parseArrayList=function(t){for(var e=0;!this.accept(it,"]");)for(this.parseExpression(t),++e;this.accept(Tt);)this.parseExpression(t),++e;return e};P.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(A,"=");){var e=t.pop(),r=[],s=t.length-1;if(e.type===st){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,o=e.value+1;n<o;n++){var i=s-n;t[i].type===q&&(t[i]=new m(Q,t[i].value))}this.parseVariableAssignmentExpression(r),t.push(new m(C,r)),t.push(new m(Et,e.value));continue}if(e.type!==q&&e.type!==H)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new m(Q,e.value)),t.push(new m(C,r)),t.push(X("="))}};P.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(A,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(A,":"),this.parseConditionalExpression(r),t.push(new m(C,e)),t.push(new m(C,r)),t.push(Ht("?"))}};P.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(A,"or");){var e=[];this.parseAndExpression(e),t.push(new m(C,e)),t.push(X("or"))}};P.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(A,"and");){var e=[];this.parseComparison(e),t.push(new m(C,e)),t.push(X("and"))}};var de=["==","!=","<","<=",">=",">","in"];P.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(A,de);){var e=this.current;this.parseAddSub(t),t.push(X(e.value))}};var ge=["+","-","||"];P.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(A,ge);){var e=this.current;this.parseTerm(t),t.push(X(e.value))}};var we=["*","/","%"];P.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(A,we);){var e=this.current;this.parseFactor(t),t.push(X(e.value))}};P.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;function r(n){return n.value in e}if(this.save(),this.accept(A,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===B&&this.nextToken.value==="("){this.restore(),this.parseExponential(t);return}else if(this.nextToken.type===Ut||this.nextToken.type===Tt||this.nextToken.type===wt||this.nextToken.type===B&&this.nextToken.value===")"){this.restore(),this.parseAtom(t);return}}var s=this.current;this.parseFactor(t),t.push(kt(s.value))}else this.parseExponential(t)};P.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(A,"^");)this.parseFactor(t),t.push(X("^"))};P.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(A,"!");)t.push(kt("!"))};P.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;function r(o){return o.value in e}if(this.accept(A,r)){var s=this.current;this.parseAtom(t),t.push(kt(s.value))}else for(this.parseMemberExpression(t);this.accept(B,"(");)if(this.accept(B,")"))t.push(new m(st,0));else{var n=this.parseArgumentList(t);t.push(new m(st,n))}};P.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(B,")");)for(this.parseExpression(t),++e;this.accept(Tt);)this.parseExpression(t),++e;return e};P.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(A,".")||this.accept(it,"[");){var e=this.current;if(e.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Lt),t.push(new m(H,this.current.value))}else if(e.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(it,"]"),t.push(X("["))}else throw new Error("unexpected symbol: "+e.value)}};function ve(t,e){return Number(t)+Number(e)}function ye(t,e){return t-e}function me(t,e){return t*e}function xe(t,e){return t/e}function Me(t,e){return t%e}function be(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function Ee(t,e){return t===e}function Ae(t,e){return t!==e}function ke(t,e){return t>e}function Pe(t,e){return t<e}function Te(t,e){return t>=e}function Oe(t,e){return t<=e}function _e(t,e){return!!(t&&e)}function Ne(t,e){return!!(t||e)}function Se(t,e){return et(e,t)}function Ce(t){return(Math.exp(t)-Math.exp(-t))/2}function Ie(t){return(Math.exp(t)+Math.exp(-t))/2}function Fe(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function Re(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function je(t){return Math.log(t+Math.sqrt(t*t-1))}function Le(t){return Math.log((1+t)/(1-t))/2}function Dt(t){return Math.log(t)*Math.LOG10E}function Ue(t){return-t}function Ve(t){return!t}function Je(t){return t<0?Math.ceil(t):Math.floor(t)}function $e(t){return Math.random()*(t||1)}function qt(t){return Vt(t+1)}function De(t){return isFinite(t)&&t===Math.round(t)}var qe=4.7421875,_t=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Vt(t){var e,r;if(De(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var s=t-2,n=t-1;s>1;)n*=s,s--;return n===0&&(n=1),n}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*Vt(1-t));if(t>=171.35)return 1/0;if(t>85){var o=t*t,i=o*t,a=i*t,c=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*o)-139/(51840*i)-571/(2488320*a)+163879/(209018880*c)+5246819/(75246796800*c*t))}--t,r=_t[0];for(var h=1;h<_t.length;++h)r+=_t[h]/(t+h);return e=t+qe+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function Be(t){return Array.isArray(t)?t.length:String(t).length}function Bt(){for(var t=0,e=0,r=0;r<arguments.length;r++){var s=Math.abs(arguments[r]),n;e<s?(n=e/s,t=t*n*n+1,e=s):s>0?(n=s/e,t+=n*n):t+=s}return e===1/0?1/0:e*Math.sqrt(t)}function Xt(t,e,r){return t?e:r}function Xe(t,e){return typeof e>"u"||+e==0?Math.round(t):(t=+t,e=-+e,isNaN(t)||!(typeof e=="number"&&e%1===0)?NaN:(t=t.toString().split("e"),t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+e:e))))}function We(t,e,r){return r&&(r[t]=e),e}function Ge(t,e){return t[e|0]}function Ke(t){return arguments.length===1&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function ze(t){return arguments.length===1&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function Qe(t,e){if(typeof t!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map(function(r,s){return t(r,s)})}function He(t,e,r){if(typeof t!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(s,n,o){return t(s,n,o)},e)}function Ye(t,e){if(typeof t!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter(function(r,s){return t(r,s)})}function Ze(t,e){if(!(Array.isArray(e)||typeof e=="string"))throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function tr(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function er(t){return(t>0)-(t<0)||+t}var Wt=1/3;function rr(t){return t<0?-Math.pow(-t,Wt):Math.pow(t,Wt)}function sr(t){return Math.exp(t)-1}function nr(t){return Math.log(1+t)}function ir(t){return Math.log(t)/Math.LN2}function Y(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||Ce,cosh:Math.cosh||Ie,tanh:Math.tanh||Fe,asinh:Math.asinh||Re,acosh:Math.acosh||je,atanh:Math.atanh||Le,sqrt:Math.sqrt,cbrt:Math.cbrt||rr,log:Math.log,log2:Math.log2||ir,ln:Math.log,lg:Math.log10||Dt,log10:Math.log10||Dt,expm1:Math.expm1||sr,log1p:Math.log1p||nr,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||Je,"-":Ue,"+":Number,exp:Math.exp,not:Ve,length:Be,"!":qt,sign:Math.sign||er},this.binaryOps={"+":ve,"-":ye,"*":me,"/":xe,"%":Me,"^":Math.pow,"||":be,"==":Ee,"!=":Ae,">":ke,"<":Pe,">=":Te,"<=":Oe,and:_e,or:Ne,in:Se,"=":We,"[":Ge},this.ternaryOps={"?":Xt},this.functions={random:$e,fac:qt,min:ze,max:Ke,hypot:Math.hypot||Bt,pyt:Math.hypot||Bt,pow:Math.pow,atan2:Math.atan2,if:Xt,gamma:Vt,roundTo:Xe,map:Qe,fold:He,filter:Ye,indexOf:Ze,join:tr},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Y.prototype.parse=function(t){var e=[],r=new P(this,new T(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect(wt,"EOF"),new L(e,this)};Y.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var ee=new Y;Y.parse=function(t){return ee.parse(t)};Y.evaluate=function(t,e){return ee.parse(t).evaluate(e)};var Gt={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function or(t){return Gt.hasOwnProperty(t)?Gt[t]:t}Y.prototype.isOperatorEnabled=function(t){var e=or(t),r=this.options.operators||{};return!(e in r)||!!r[e]};const V=new Y;V.unaryOps={"-":V.unaryOps["-"],"+":V.unaryOps["+"],"!":V.unaryOps["!"]};V.functions={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,log:Math.log,atan2:Math.atan2,pow:Math.pow,radians:t=>t*(Math.PI/180),degrees:t=>t*(180/Math.PI)};V.binaryOps={...V.binaryOps,"+":(t,e)=>(dt(t)&&(t=Number(t)),dt(e)&&(e=Number(e)),t+e),in:(t,e)=>Array.isArray(e)||typeof e=="string"?e.includes(t):t in e};V.consts={...V.consts,pi:Math.PI,e:Math.E};function ar(t){return V.evaluate(t)}class ur{constructor(){this.inOrder=!0,this.requirePrefix=!0,this.localProperties=!0,this.rospackCommands={},this.workingPath=""}async getFileContents(e){throw new Error("XacroParser: getFileContents() not implemented.")}async parse(e){function r(f,d,M=!1){function y(w,E){return typeof w=="number"?w:w.replace(/(\$?\$\([^)]+\))|(\$?\${[^}]+})/g,N=>{if(/^\$\$/.test(N))return N;const $=/^\$\(/.test(N);let x=N.substring(2,N.length-1);if(x=y(x,E),$){const j=y(x,E).split(/\s+/g),I=j.shift();try{return G(I,...j)}catch(ct){throw new Error(`XacroParser: Cannot run rospack command "${x}".
`+ct.message)}}else{if(b.includes(x))throw new Error(`XacroParser: Cannot evaluate infinitely recursive expression: ${b.join(" > ")} > ${x}`);b.push(x);const U=/(()|()|()|[()/*+\-%|&=[\]])+/g,j=he(x).map(I=>{if(U.lastIndex=0,ue(I)||dt(I)||Jt(I))return I;if(I in E){const ct=y(E[I],E);return dt(ct)?ct:`"${ct.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}else return I}).join("");if(b.pop(),Jt(j))return j.substring(1,j.length-1);if(dt(j))return j;{const I=le(j);return vt(I)}}})}const b=[],g=St(S,d);try{let w=y(f,g);return M&&(w=w.replace(/\${2}([({])/g,(E,k)=>`$${k}`)),w}catch(w){throw new Error(`XacroParser: Failed to process expression "${f}". 
`+w.message)}}async function s(f,d,M,y){const b=f.tagName.replace(/^xacro:/,""),g=M[b];if(!g)throw new Error(`XacroParser: Cannot find macro "${b}"`);const w=d,E=M;d=ce(d),M=St(M);let k=[];for(const x of f.children)await i(x,w,E,k);k=k.filter(x=>x.nodeType===x.ELEMENT_NODE);let N=0;for(const x in g.params){const U=g.params[x];f.hasAttribute(x)?d[x]=r(f.getAttribute(x),w):U.type==="BLOCK"?(d[x]=[k[N]],N++):U.type==="MULTI_BLOCK"?d[x]=[...k.filter(j=>j.tagName===x)[0].childNodes]:d[x]=r(g.params[x].def,w)}const $=[...g.node.childNodes];for(const x of $){const U=[];await i(x,d,M,U),y.push(...U)}}function n(f){const d={};if(/^\*\*/.test(f)?d.type="MULTI_BLOCK":/^\*/.test(f)?d.type="BLOCK":d.type="PARAM",f=f.replace(/^\*{1,2}/g,""),/:=/.test(f)){const[M,y]=f.split(":=");if(/^\^/.test(y)||/\|/.test(y))throw new Error(`XacroParser: ROS Jade pass-through notation not supported in macro defaults: ${y}`);d.name=M,d.def=y}else d.name=f,d.def=null;return d}function o(f){const d=f.getAttribute("name").replace(/^xacro:/,""),M=f.getAttribute("params"),y={};return M&&M.trim().split(/\s+/g).map(g=>n(g)).forEach(g=>{y[g.name]=g}),{name:d,node:ft(f,!1),params:y}}async function i(f,d,M,y=[]){if(f.nodeType!==f.ELEMENT_NODE){const g=f.cloneNode();g.textContent=r(g.textContent,d,!0),y.push(g);return}let b=f.tagName.toLowerCase();if(!O)switch(b){case"arg":case"property":case"macro":case"insert_block":case"if":case"unless":case"include":case"element":case"attribute":b=`xacro:${b}`;break;default:b in M&&(b=`xacro:${b}`);break}switch(b){case"xacro:property":{tt(y);const g=f.getAttribute("name");let w;if(f.hasAttribute("value"))w=f.getAttribute("value");else if(f.hasAttribute("default"))w=f.getAttribute("default");else{const k=[...f.childNodes];w=[];for(const N of k)w.push(ft(N,!1))}let E="global";W&&(E=f.getAttribute("scope")||"local"),E!=="local"&&(w=r(w,d)),E==="global"?S[g]=w:E==="parent"?d[rt][g]=w:d[g]=w;break}case"xacro:macro":{tt(y);const g=o(f);M[g.name]=g;break}case"xacro:insert_block":{tt(y);const g=f.getAttribute("name"),w=d[g];for(const E of w)await i(E,d,M,y);return}case"xacro:if":case"xacro:unless":{tt(y);const g=r(f.getAttribute("value"),d,!0);let w=null;if(isNaN(parseFloat(g))?g==="true"||g==="false"?w=g==="true":w=g:w=!!parseFloat(g),b==="xacro:unless"&&(w=!w),w){const E=[...f.childNodes];for(const k of E)await i(k,d,M,y)}return}case"xacro:include":{if(tt(y),f.hasAttribute("ns"))throw new Error("XacroParser: xacro:include name spaces not supported.");const g=r(f.getAttribute("filename"),d,!0),E=/^[/\\]/.test(g)||/^[a-zA-Z]+:[/\\]/.test(g)?g:Z+g,k=Z;Z=Nt(E);const $=[...(await h(E)).children[0].childNodes];for(const x of $)await i(x,d,M,y);Z=k;return}case"xacro:arg":case"xacro:attribute":case"xacro:element":throw new Error(`XacroParser: ${b} tags not supported.`);default:{if(/^xacro:/.test(b)||b in M)return tt(y),s(f,d,M,y);{const g=f.cloneNode();for(let k=0,N=g.attributes.length;k<N;k++){const $=g.attributes[k],x=r($.value,d,!0);g.setAttribute($.name,x)}const w=[...f.childNodes],E=[];for(let k=0,N=w.length;k<N;k++)await i(w[k],d,M,E);E.forEach(k=>g.appendChild(k)),y.push(g)}}}}async function a(f,d,M){const y=K(f,"xacro:property");O||y.push(...K(f,"property"));for(const g of y)await i(g,d,M);const b=K(f,"xacro:macro");O||b.push(...K(f,"macro"));for(const g of b)await i(g,d,M)}async function c(f,d,M){const y=f.cloneNode();for(let b=0,g=f.children.length;b<g;b++){const w=[];await i(f.children[b],d,M,w);const E=w[0];E.removeAttribute("xmlns:xacro"),y.appendChild(E)}return y}async function h(f){try{const d=await p.getFileContents(f);return new DOMParser().parseFromString(d,"text/xml")}catch{throw new Error(`XacroParser: Could not load included file: ${f}`)}}async function l(f,d,M=[]){const y=K(f,"xacro:include");O||y.push(...K(f,"include"));const b=y.map(g=>{if(g.hasAttribute("ns"))throw new Error("XacroParser: xacro:include name spaces not supported.");const w=g.getAttribute("filename"),E=g.getAttribute("ns")||null,N=/^[/\\]/.test(w)||/^[a-zA-Z]+:[/\\]/.test(w)?w:d+w;return h(N).then(x=>{M.push({filename:w,namespace:E,content:x});const U=Nt(N);return l(x,U,M)})});return await Promise.all(b),M}const p=this,u=this.inOrder,v=this.workingPath+(this.workingPath&&!/[\\/]$/.test(this.workingPath)?"/":""),O=this.requirePrefix,_=this.rospackCommands,J={},ht={},S={True:1,False:0};S[rt]=S;const G=(f,...d)=>_ instanceof Function?_(f,...d):_[f](...d),vt=ar;let W=this.localProperties,Z=v,lt=new DOMParser().parseFromString(e,"text/xml");W&&!u&&(console.warn('XacroParser: Implicitly setting "localProperties" option to false because "inOrder" is false.'),W=!1);let Ot=null;return u?Ot=Promise.resolve():Ot=async function(){return await a(lt,S,J),lt=ft(lt,!0),l(lt,v).then(f=>{f.forEach(d=>{a(d.content,S,J),d.content=ft(d.content,!0),ht[d.filename]=d.content})})}(),await Ot,c(lt,S,J)}}class re extends ur{constructor(){super(),this.fetchOptions={}}load(e,r,s){const n=Nt(e);this.workingPath===""&&(this.workingPath=n),this.getFileContents(e).then(o=>{this.parse(o,r,s)}).catch(o=>{s&&s(o)})}parse(e,r,s){super.parse(e).then(r).catch(n=>{s&&s(n)})}getFileContents(e){return fetch(e,this.fetchOptions).then(r=>{if(r.ok)return r.text();throw new Error(`XacroLoader: Failed to load url '${e}' with error code ${r.status} : ${r.statusText}.`)})}}function pr(){return new Promise((t,e)=>{const r="https://raw.githubusercontent.com/gkjohnson/curiosity_mars_rover-mirror/master/curiosity_mars_rover_description/urdf/curiosity_mars_rover.xacro",s=new re;s.rospackCommands={find(n){switch(n){case"curiosity_mars_rover_description":return"https://raw.githubusercontent.com/gkjohnson/curiosity_mars_rover-mirror/master/curiosity_mars_rover_description/";default:return n}}},s.load(r,n=>{let o,i,a;const c=new yt;c.onLoad=()=>{const v=[];i.traverse(O=>{(O.isLight||O.isLineSegments)&&v.push(O)}),v.forEach(O=>{O.parent.remove(O)}),t({ik:o,urdf:i,goalMap:a,helperScale:.3})};const h=new xt(c);h.packages={curiosity_mars_rover_description:"https://raw.githubusercontent.com/gkjohnson/curiosity_mars_rover-mirror/master/curiosity_mars_rover_description/"},i=h.parse(n),i.joints.arm_03_joint.limit.upper=Math.PI*3/2,o=Mt(i),o.clearDoF(),Kt(o.quaternion,-90,0,0),o.position[1]-=.5,o.setMatrixNeedsUpdate(),i.setJointValue("arm_02_joint",-Math.PI/2),i.setJointValue("arm_03_joint",Math.PI),i.setJointValue("arm_04_joint",Math.PI),bt(o,i),a=new Map;const l=o.find(v=>v.name==="arm_tools"),p=i.links.arm_tools,u=new mt;u.name=p.name,u.makeClosure(l),l.getWorldPosition(u.position),l.getWorldQuaternion(u.quaternion),u.setMatrixNeedsUpdate(),a.set(u,l)},e)})}function fr(){return new Promise((t,e)=>{const r="https://raw.githubusercontent.com/ros-industrial/staubli_experimental/ce422fe0a54232d73cf44e2571fc7abc2f5ff9f6/staubli_tx2_90_support/urdf/tx2_90.xacro",s=new re;s.rospackCommands={find(n){switch(n){case"staubli_resources":return"https://raw.githubusercontent.com/ros-industrial/staubli/indigo-devel/staubli_resources/";case"staubli_tx2_90_support":return"https://raw.githubusercontent.com/ros-industrial/staubli_experimental/ce422fe0a54232d73cf44e2571fc7abc2f5ff9f6/staubli_tx2_90_support/";default:return n}}},s.load(r,n=>{let o,i,a;const c=new yt;c.onLoad=()=>{t({ik:o,urdf:i,goalMap:a,helperScale:.3})};const h=new xt(c);h.packages={staubli_tx2_90_support:"https://raw.githubusercontent.com/ros-industrial/staubli_experimental/ce422fe0a54232d73cf44e2571fc7abc2f5ff9f6/staubli_tx2_90_support/"},i=h.parse(n),o=Mt(i),o.clearDoF(),Kt(o.quaternion,-90,0,0),o.position[1]-=.5,o.setMatrixNeedsUpdate(),i.setJointValue("joint_2",Math.PI/4),i.setJointValue("joint_3",Math.PI/2),i.setJointValue("joint_5",-Math.PI/4),bt(o,i),a=new Map;const l=o.find(v=>v.name==="tool0"),p=i.links.tool0,u=new mt;u.name=p.name,u.makeClosure(l),l.getWorldPosition(u.position),l.getWorldQuaternion(u.quaternion),u.setMatrixNeedsUpdate(),a.set(u,l)},e)})}function dr(){return new Promise((t,e)=>{let r,s,n;const o=new yt;o.onLoad=()=>{t({ik:r,urdf:s,goalMap:n})},new xt(o).load("https://raw.githubusercontent.com/gkjohnson/urdf-loaders/master/urdf/T12/urdf/T12_flipped.URDF",c=>{s=c,r=Mt(s);const h=Math.PI/180;s.rotation.set(Math.PI/2,0,0);for(let l=1;l<=6;l++)s.joints[`HP${l}`].setJointValue(30*h),s.joints[`KP${l}`].setJointValue(90*h),s.joints[`AP${l}`].setJointValue(-30*h);bt(r,s),n=new Map,r.traverse(l=>{if(l.isJoint)l.dofRestPose.set(l.dofValues),l.restPoseSet=!0;else if(/^Foot/.test(l.name)){const p=s.links[l.name],u=new mt;u.name=p.name,u.makeClosure(l),l.getWorldPosition(u.position),l.getWorldQuaternion(u.quaternion),u.setMatrixNeedsUpdate(),n.set(u,l)}})},null,e)})}function gr(){return new Promise((t,e)=>{let r,s,n;const o=new yt;o.onLoad=()=>{t({ik:s,urdf:r,goalMap:n,helperScale:.2})};const i="https://raw.githubusercontent.com/gkjohnson/nasa-urdf-robots/master/r2_description/robots/r2b.urdf",a=new xt(o);a.packages={r2_description:"https://raw.githubusercontent.com/gkjohnson/nasa-urdf-robots/master/r2_description"},a.load(i,c=>{r=c,r.rotation.set(-Math.PI/2,0,0),s=Mt(r),r.joints["r2/left_leg/joint3"].setJointValue(60*F),r.joints["r2/left_leg/joint5"].setJointValue(60*F),r.joints["r2/left_arm/joint1"].setJointValue(-80*F),r.joints["r2/left_arm/joint2"].setJointValue(-100*F),r.joints["r2/left_arm/joint3"].setJointValue(-90*F),r.joints["r2/left_arm/joint4"].setJointValue(90*F),r.joints["r2/right_leg/joint3"].setJointValue(60*F),r.joints["r2/right_leg/joint5"].setJointValue(60*F),r.joints["r2/right_arm/joint1"].setJointValue(-80*F),r.joints["r2/right_arm/joint2"].setJointValue(100*F),r.joints["r2/right_arm/joint3"].setJointValue(-90*F),r.joints["r2/right_arm/joint4"].setJointValue(-90*F),bt(s,r),n=new Map,s.traverse(h=>{if(h.isJoint)h.dofRestPose.set(h.dofValues),h.restPoseSet=!0;else if(h.name==="r2/left_leg_foot"||h.name==="r2/right_leg_foot"){const l=r.links[h.name],p=new mt;p.name=l.name,p.makeClosure(h),h.getWorldPosition(p.position),h.getWorldQuaternion(p.quaternion),p.setMatrixNeedsUpdate(),n.set(p,h)}})},null,e)})}export{cr as W,fr as a,pr as b,gr as c,dr as l};
